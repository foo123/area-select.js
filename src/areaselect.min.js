/**
*  area-select.js
*  A simple js class to select rectangular regions in DOM elements (image, canvas, video, etc..)
*  @VERSION: 1.1.0
*
*  https://github.com/foo123/area-select.js
*
**/
!function(e,t,n){"use strict";var i;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=i=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return i})}("undefined"!=typeof self?self:this,"AreaSelect",function(t){"use strict";var n=Math.abs,i=Math.round,a=function(e){return parseInt(e||0,10)||0},o=function(e){return parseFloat(e||0,10)||0},s=/^\s+|\s+$/g,l=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(s,"")},r=0,c=1,u=2,h=4,d=8,_=16,m=32,f=h|d,y=_|m,p=f|y,w="function"==typeof window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},x=window.document;function g(e){var t=document.createElement("div");return e&&(t.className=e),t}function v(e,t){(function(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")})(e,t)||(e.classList?e.classList.add(t):e.className=""===e.className?t:e.className+" "+t)}function b(e,t){e.classList?e.classList.remove(t):e.className=l((" "+e.className+" ").replace(" "+t+" "," "))}function W(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)}function E(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)}function D(e,s){var l=this;if(!(l instanceof D))return new D(e,s);s=s||{},l.element(e),l.selection=null;var R=l.area={x:0,y:0,w:0,h:0};R.main=g(s.className?"area-select area-select-marching-ants "+s.className:"area-select area-select-marching-ants"),R.main.appendChild(R.__n=g("area-select-resize area-select-resize-n")),R.main.appendChild(R.__e=g("area-select-resize area-select-resize-e")),R.main.appendChild(R.__s=g("area-select-resize area-select-resize-s")),R.main.appendChild(R.__w=g("area-select-resize area-select-resize-w")),R.main.appendChild(R.__nw=g("area-select-resize area-select-resize-nw")),R.main.appendChild(R.__ne=g("area-select-resize area-select-resize-ne")),R.main.appendChild(R.__sw=g("area-select-resize area-select-resize-sw")),R.main.appendChild(R.__se=g("area-select-resize area-select-resize-se")),R.main.style.position="absolute",R.main.style.display="none",R.main.style.left="0px",R.main.style.top="0px",R.main.style.width="0px",R.main.style.height="0px",R.__n.__RESIZE=_,R.__n.__DIR="n",R.__s.__RESIZE=m,R.__s.__DIR="s",R.__e.__RESIZE=h,R.__e.__DIR="e",R.__w.__RESIZE=d,R.__w.__DIR="w",R.__ne.__RESIZE=_|h,R.__ne.__DIR="ne",R.__nw.__RESIZE=_|d,R.__nw.__DIR="nw",R.__se.__RESIZE=m|h,R.__se.__DIR="se",R.__sw.__RESIZE=m|d,R.__sw.__DIR="sw",e.parentNode.appendChild(R.main),l.options={minWidth:null!=s.minWidth?a(s.minWidth):null,minHeight:null!=s.minHeight?a(s.minHeight):null,maxWidth:null!=s.maxWidth?a(s.maxWidth):null,maxHeight:null!=s.maxHeight?a(s.maxHeight):null,ratioXY:null!=s.ratioXY?o(s.ratioXY):null,ratioYX:null!=s.ratioYX?o(s.ratioYX):null,withBorders:t!==s.withBorders&&!!s.withBorders,onSelect:"function"==typeof s.onSelect?s.onSelect:null};var X=0,Y=0,S=0,z=0,H=r,I=function(e,t){if(e=e||window.event,l.el===e.target){t&&e.preventDefault&&e.preventDefault();var n,i=l.options,o=l.el,s=l.area,r=o.getBoundingClientRect(),u=o.offsetLeft,h=o.offsetTop,d=o.offsetWidth,_=o.offsetHeight,m=o.scrollLeft,f=o.scrollTop,y=0,p=0;i.withBorders?(n=w(o),y=a(n.borderLeftWidth),p=a(n.borderTopWidth)):(y=0,p=0),t?(X=e.changedTouches[0].clientX-y-r.left,Y=e.changedTouches[0].clientY-p-r.top):(X=e.clientX-y-r.left,Y=e.clientY-p-r.top),X<0?X=0:X>=d&&(X=d-1),Y<0?Y=0:Y>=_&&(Y=_-1),H=c,s.main.style.display="block",s.x=X,s.y=Y,s.w=0,s.h=0,s.main.style.left=u-m+s.x+"px",s.main.style.top=h-f+s.y+"px",s.main.style.width="0px",s.main.style.height="0px",s.main.style.cursor="se-resize",v(o,"area-selecting"),v(s.main,"area-select-active"),v(s.main,"area-select-create"),t?(W(x.body,"touchcancel",j),W(x.body,"touchmove",N),W(x.body,"touchend",Z)):(W(x.body,"mousemove",L),W(x.body,"mouseup",B))}},C=function(e,t){if(e=e||window.event,l.area.main===e.target){t&&e.preventDefault&&e.preventDefault();var n,i=l.options,o=l.el,s=l.area,r=o.getBoundingClientRect(),c=o.offsetWidth,h=o.offsetHeight,d=0,_=0;i.withBorders?(n=w(o),d=a(n.borderLeftWidth),_=a(n.borderTopWidth)):(d=0,_=0),t?(X=e.changedTouches[0].clientX-d-r.left,Y=e.changedTouches[0].clientY-_-r.top):(X=e.clientX-d-r.left,Y=e.clientY-_-r.top),X<0?X=0:X>=c&&(X=c-1),Y<0?Y=0:Y>=h&&(Y=h-1),H=u,s.main.style.cursor="move",v(o,"area-selecting"),v(s.main,"area-select-active"),v(s.main,"area-select-move"),t?(W(x.body,"touchcancel",j),W(x.body,"touchmove",N),W(x.body,"touchend",Z)):(W(x.body,"mousemove",L),W(x.body,"mouseup",B))}},T=function(e,t){var n=(e=e||window.event).target,i=l.area;if(i.__n===n||i.__s===n||i.__e===n||i.__w===n||i.__ne===n||i.__nw===n||i.__se===n||i.__sw===n){t&&e.preventDefault&&e.preventDefault();var o,s=l.options,r=l.el,c=r.getBoundingClientRect(),u=r.offsetWidth,h=r.offsetHeight,d=0,_=0;s.withBorders?(o=w(r),d=a(o.borderLeftWidth),_=a(o.borderTopWidth)):(d=0,_=0),t?(X=e.changedTouches[0].clientX-d-c.left,Y=e.changedTouches[0].clientY-_-c.top):(X=e.clientX-d-c.left,Y=e.clientY-_-c.top),X<0?X=0:X>=u&&(X=u-1),Y<0?Y=0:Y>=h&&(Y=h-1),H=n.__RESIZE||0,i.x0=i.x,i.y0=i.y,i.x1=i.x+i.w,i.y1=i.y+i.h,i.main.style.cursor=(n.__DIR||"se")+"-resize",v(r,"area-selecting"),v(i.main,"area-select-active"),v(i.main,"area-select-resize"),t?(W(x.body,"touchcancel",j),W(x.body,"touchmove",N),W(x.body,"touchend",Z)):(W(x.body,"mousemove",L),W(x.body,"mouseup",B))}},L=function(e){q(e,!1)},B=function(e){O(e,!1)},N=function(e){q(e,!0)},Z=function(e){O(e,!0)},j=function(t){(t=t||window.event).preventDefault&&t.preventDefault(),E(x.body,"touchcancel",j),E(x.body,"touchmove",N),E(x.body,"touchend",Z),X=Y=S=z=0,c&H?b(R.main,"area-select-create"):u&H?b(R.main,"area-select-move"):p&H&&b(R.main,"area-select-resize"),b(R.main,"area-select-active"),b(e,"area-selecting"),R.main.style.cursor="",H=r},q=function(e,t){e=e||window.event,t&&e.preventDefault&&e.preventDefault();var o,s,r,x=l.options,g=l.el,v=l.area,b=g.getBoundingClientRect(),W=g.offsetLeft,E=g.offsetTop,D=g.offsetWidth,R=g.offsetHeight,I=g.scrollLeft,C=g.scrollTop,T=0,L=0,B="e",N="s";if(x.withBorders?(o=w(g),T=a(o.borderLeftWidth),L=a(o.borderTopWidth)):(T=0,L=0),t?(S=e.changedTouches[0].clientX-T-b.left,z=e.changedTouches[0].clientY-L-b.top):(S=e.clientX-T-b.left,z=e.clientY-L-b.top),S<0?S=0:S>=D&&(S=D-1),z<0?z=0:z>=R&&(z=R-1),c&H)s=v.w,r=v.h,S<X?(v.x=S,v.w=X-S,B="w"):(v.x=X,v.w=S-X),z<Y?(v.y=z,v.h=Y-z,N="n"):(v.y=Y,v.h=z-Y),x.ratioYX?v.h=i(v.w*x.ratioYX):x.ratioXY&&(v.w=i(v.h*x.ratioXY)),null!=x.minWidth&&v.w<x.minWidth&&(v.w=x.minWidth),null!=x.minHeight&&v.h<x.minHeight&&(v.h=x.minHeight),null!=x.maxWidth&&v.w>x.maxWidth&&(v.w=x.maxWidth),null!=x.maxHeight&&v.h>x.maxHeight&&(v.h=x.maxHeight),v.x+v.w>D&&(v.w=D-v.x-1),v.y+v.h>R&&(v.h=R-v.y-1),v.main.style.left=W-I+v.x+"px",v.main.style.top=E-C+v.y+"px",v.main.style.width=v.w+"px",v.main.style.height=v.h+"px",2>n(s-v.w)&&(B=""),2>n(r-v.h)&&(N=""),B||N||(B="se"),v.main.style.cursor=N+B+"-resize";else if(u&H){if(v.main!==e.target)return;v.x+=S-X,v.y+=z-Y,X=S,Y=z,v.x+v.w>=D?v.x=D-v.w-1:v.x<0&&(v.x=0),v.y+v.h>=R?v.y=R-v.h-1:v.y<0&&(v.y=0),v.main.style.left=W-I+v.x+"px",v.main.style.top=E-C+v.y+"px",v.main.style.cursor="move"}else p&H&&(h&H&&(S<v.x0?(v.x=S,v.w=v.x0-S):(v.x=v.x0,v.w=S-v.x0)),d&H&&(S>v.x1?(v.x=v.x1,v.w=S-v.x1):(v.x=S,v.w=v.x1-S)),m&H&&(z<v.y0?(v.y=z,v.h=v.y0-z):(v.y=v.y0,v.h=z-v.y0)),_&H&&(z>v.y1?(v.y=v.y1,v.h=z-v.y1):(v.y=z,v.h=v.y1-z)),x.ratioYX?f&H?v.h=i(v.w*x.ratioYX):v.w=i(v.h/x.ratioYX):x.ratioXY&&(y&H?v.w=i(v.h*x.ratioXY):v.h=i(v.w/x.ratioXY)),null!=x.minWidth&&v.w<x.minWidth&&(v.w=x.minWidth),null!=x.maxWidth&&v.w>x.maxWidth&&(v.w=x.maxWidth),null!=x.minHeight&&v.h<x.minHeight&&(v.h=x.minHeight),null!=x.maxHeight&&v.h>x.maxHeight&&(v.h=x.maxHeight),v.x+v.w>D&&(v.w=D-v.x-1),v.y+v.h>R&&(v.h=R-v.y-1),v.main.style.left=W-I+v.x+"px",v.main.style.top=E-C+v.y+"px",v.main.style.width=v.w+"px",v.main.style.height=v.h+"px",v.main.style.cursor=e.target.__DIR+"-resize")},O=function(e,t){var n=l.el,a=l.area,o=l.options;e=e||window.event,t&&e.preventDefault&&e.preventDefault(),l.selection={x1:i(a.x),y1:i(a.y),x2:i(a.x+a.w),y2:i(a.y+a.h)},X=Y=S=z=0,t?(E(x.body,"touchcancel",j),E(x.body,"touchmove",N),E(x.body,"touchend",Z)):(E(x.body,"mousemove",L),E(x.body,"mouseup",B)),c&H?b(a.main,"area-select-create"):u&H?b(a.main,"area-select-move"):p&H&&b(a.main,"area-select-resize"),b(a.main,"area-select-active"),b(n,"area-selecting"),a.main.style.cursor="",H=r,o.onSelect&&setTimeout(function(){o.onSelect.call(l,l.el,l.getSelection())},10)};e.__area_select_evt=[function(e){I(e,!1)},function(e){I(e,!0)}],W(e,"mousedown",e.__area_select_evt[0]),W(e,"touchstart",e.__area_select_evt[1]),W(R.__n,"mousedown",function(e){T(e,!1)}),W(R.__s,"mousedown",function(e){T(e,!1)}),W(R.__e,"mousedown",function(e){T(e,!1)}),W(R.__w,"mousedown",function(e){T(e,!1)}),W(R.__ne,"mousedown",function(e){T(e,!1)}),W(R.__nw,"mousedown",function(e){T(e,!1)}),W(R.__se,"mousedown",function(e){T(e,!1)}),W(R.__sw,"mousedown",function(e){T(e,!1)}),W(R.__n,"touchstart",function(e){T(e,!0)}),W(R.__s,"touchstart",function(e){T(e,!0)}),W(R.__e,"touchstart",function(e){T(e,!0)}),W(R.__w,"touchstart",function(e){T(e,!0)}),W(R.__ne,"touchstart",function(e){T(e,!0)}),W(R.__nw,"touchstart",function(e){T(e,!0)}),W(R.__se,"touchstart",function(e){T(e,!0)}),W(R.__sw,"touchstart",function(e){T(e,!0)}),W(R.main,"mousedown",function(e){C(e,!1)}),W(R.main,"touchstart",function(e){C(e,!0)})}return D.VERSION="1.1.0",D.prototype={constructor:D,el:null,area:null,selection:null,options:null,dispose:function(){var t=this.el,n=this.area;return this.deselect(),t&&(t.__area_select_evt&&(E(t,"mousedown",t.__area_select_evt[0]),E(t,"touchstart",t.__area_select_evt[1]),t.__area_select_evt=null),n&&n.main&&t.parentNode.removeChild(n.main),e.draggable=t.__area_select_draggable,t.__area_select_draggable=null,b(t,"area-selectable")),this.el=null,this.area=null,this.selection=null,this.options=null,this},element:function(e){return function(e){e.__area_select_draggable=e.draggable||!1,e.draggable=!1,e.onmousedown=function(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!1}}(this.el=e),v(this.el,"area-selectable"),this},reset:function(){return this.selection=null,this.options={},this},show:function(){return this.area.main.style.display="block",this.area.main.style.cursor="",this},hide:function(){return this.area.main.style.display="none",this.area.main.style.cursor="",this},select:function(e){var t=this.el,n=this.area;return"object"==typeof e?(n.x=e.x1,n.y=e.y1,n.w=e.x2-e.x1,n.h=e.y2-e.y1,n.main.style.left=t.offsetLeft-t.scrollLeft+n.x+"px",n.main.style.top=t.offsetTop-t.scrollTop+n.y+"px",n.main.style.width=n.w+"px",n.main.style.height=n.h+"px",this.selection={x1:i(n.x),y1:i(n.y),x2:i(n.x+n.w),y2:i(n.y+n.h)}):!1===e&&(this.selection=null),this},deselect:function(){return this.selection=null,this.hide()},getSelection:function(){var e=this.selection;return e?{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,width:n(e.x2-e.x1),height:n(e.y2-e.y1)}:null}},D});