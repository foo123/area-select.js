/**
*  area-select.js
*  A simple js class to select rectangular regions in DOM elements (image, canvas, video, etc..)
*  @VERSION: 1.1.0
*
*  https://github.com/foo123/area-select.js
*
**/
!function(e,t){"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(function(e){return t()}):e.AreaSelect=t()}("undefined"!=typeof self?self:this,function(r){"use strict";var D=Math.abs,R=Math.round,X=function(e){return parseInt(e||0,10)||0},c=function(e){return parseFloat(e||0,10)||0},t=/^\s+|\s+$/g,n=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(t,"")},u=0,Y=1,z=2,H=4,S=8,I=16,T=32,L=H|S,C=I|T,N=L|C,B="function"==typeof window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},Z=window.document;function h(e){var t=document.createElement("div");return e&&(t.className=e),t}function j(e,t){var n,i;i=t,((n=e).classList?n.classList.contains(i):-1!==(" "+n.className+" ").indexOf(" "+i+" "))||(e.classList?e.classList.add(t):e.className=""===e.className?t:e.className+" "+t)}function _(e,t){e.classList?e.classList.remove(t):e.className=n((" "+e.className+" ").replace(" "+t+" "," "))}function k(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)}function d(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)}function M(t,e){var y=this;if(!(y instanceof M))return new M(t,e);e=e||{},y.element(t),y.selection=null;var n=y.area={x:0,y:0,w:0,h:0};n.main=h(e.className?"area-select area-select-marching-ants "+e.className:"area-select area-select-marching-ants"),n.main.appendChild(n.__n=h("area-select-resize area-select-resize-n")),n.main.appendChild(n.__e=h("area-select-resize area-select-resize-e")),n.main.appendChild(n.__s=h("area-select-resize area-select-resize-s")),n.main.appendChild(n.__w=h("area-select-resize area-select-resize-w")),n.main.appendChild(n.__nw=h("area-select-resize area-select-resize-nw")),n.main.appendChild(n.__ne=h("area-select-resize area-select-resize-ne")),n.main.appendChild(n.__sw=h("area-select-resize area-select-resize-sw")),n.main.appendChild(n.__se=h("area-select-resize area-select-resize-se")),n.main.style.position="absolute",n.main.style.display="none",n.main.style.left="0px",n.main.style.top="0px",n.main.style.width="0px",n.main.style.height="0px",n.__n.__RESIZE=I,n.__n.__DIR="n",n.__s.__RESIZE=T,n.__s.__DIR="s",n.__e.__RESIZE=H,n.__e.__DIR="e",n.__w.__RESIZE=S,n.__w.__DIR="w",n.__ne.__RESIZE=I|H,n.__ne.__DIR="ne",n.__nw.__RESIZE=I|S,n.__nw.__DIR="nw",n.__se.__RESIZE=T|H,n.__se.__DIR="se",n.__sw.__RESIZE=T|S,n.__sw.__DIR="sw",t.parentNode.appendChild(n.main),y.options={minWidth:null!=e.minWidth?X(e.minWidth):null,minHeight:null!=e.minHeight?X(e.minHeight):null,maxWidth:null!=e.maxWidth?X(e.maxWidth):null,maxHeight:null!=e.maxHeight?X(e.maxHeight):null,ratioXY:null!=e.ratioXY?c(e.ratioXY):null,ratioYX:null!=e.ratioYX?c(e.ratioYX):null,withBorders:r!==e.withBorders&&!!e.withBorders,onSelect:"function"==typeof e.onSelect?e.onSelect:null};function i(e,t){var n,i,a,o,s,l,r,c,u,h,_,d;e=e||window.event,y.el===e.target&&(t&&e.preventDefault&&e.preventDefault(),h=y.options,n=y.el,i=y.area,a=n.getBoundingClientRect(),o=n.offsetLeft,s=n.offsetTop,l=n.offsetWidth,r=n.offsetHeight,c=n.scrollLeft,u=n.scrollTop,d=_=0,d=h.withBorders?(h=B(n),_=X(h.borderLeftWidth),X(h.borderTopWidth)):_=0,w=t?(p=e.changedTouches[0].clientX-_-a.left,e.changedTouches[0].clientY-d-a.top):(p=e.clientX-_-a.left,e.clientY-d-a.top),p<0?p=0:l<=p&&(p=l-1),w<0?w=0:r<=w&&(w=r-1),v=Y,i.main.style.display="block",i.x=p,i.y=w,i.w=0,i.h=0,i.main.style.left=o-c+i.x+"px",i.main.style.top=s-u+i.y+"px",i.main.style.width="0px",i.main.style.height="0px",i.main.style.cursor="se-resize",j(n,"area-selecting"),j(i.main,"area-select-active"),j(i.main,"area-select-create"),t?(k(Z.body,"touchcancel",E),k(Z.body,"touchmove",b),k(Z.body,"touchend",W)):(k(Z.body,"mousemove",m),k(Z.body,"mouseup",f)))}function a(e,t){var n,i,a,o,s,l,r,c;e=e||window.event,y.area.main===e.target&&(t&&e.preventDefault&&e.preventDefault(),l=y.options,n=y.el,i=y.area,a=n.getBoundingClientRect(),o=n.offsetWidth,s=n.offsetHeight,c=r=0,c=l.withBorders?(l=B(n),r=X(l.borderLeftWidth),X(l.borderTopWidth)):r=0,w=t?(p=e.changedTouches[0].clientX-r-a.left,e.changedTouches[0].clientY-c-a.top):(p=e.clientX-r-a.left,e.clientY-c-a.top),p<0?p=0:o<=p&&(p=o-1),w<0?w=0:s<=w&&(w=s-1),v=z,i.main.style.cursor="move",j(n,"area-selecting"),j(i.main,"area-select-active"),j(i.main,"area-select-move"),t?(k(Z.body,"touchcancel",E),k(Z.body,"touchmove",b),k(Z.body,"touchend",W)):(k(Z.body,"mousemove",m),k(Z.body,"mouseup",f)))}function o(e,t){var n,i,a,o,s,l,r,c=(e=e||window.event).target,u=y.area;u.__n!==c&&u.__s!==c&&u.__e!==c&&u.__w!==c&&u.__ne!==c&&u.__nw!==c&&u.__se!==c&&u.__sw!==c||(t&&e.preventDefault&&e.preventDefault(),s=y.options,i=(n=y.el).getBoundingClientRect(),a=n.offsetWidth,o=n.offsetHeight,r=l=0,r=s.withBorders?(s=B(n),l=X(s.borderLeftWidth),X(s.borderTopWidth)):l=0,w=t?(p=e.changedTouches[0].clientX-l-i.left,e.changedTouches[0].clientY-r-i.top):(p=e.clientX-l-i.left,e.clientY-r-i.top),p<0?p=0:a<=p&&(p=a-1),w<0?w=0:o<=w&&(w=o-1),v=c.__RESIZE||0,u.x0=u.x,u.y0=u.y,u.x1=u.x+u.w,u.y1=u.y+u.h,u.main.style.cursor=(c.__DIR||"se")+"-resize",j(n,"area-selecting"),j(u.main,"area-select-active"),j(u.main,"area-select-resize"),t?(k(Z.body,"touchcancel",E),k(Z.body,"touchmove",b),k(Z.body,"touchend",W)):(k(Z.body,"mousemove",m),k(Z.body,"mouseup",f)))}var p=0,w=0,x=0,g=0,v=u,m=function(e){s(e,!1)},f=function(e){l(e,!1)},b=function(e){s(e,!0)},W=function(e){l(e,!0)},E=function(e){(e=e||window.event).preventDefault&&e.preventDefault(),d(Z.body,"touchcancel",E),d(Z.body,"touchmove",b),d(Z.body,"touchend",W),p=w=x=g=0,Y&v?_(n.main,"area-select-create"):z&v?_(n.main,"area-select-move"):N&v&&_(n.main,"area-select-resize"),_(n.main,"area-select-active"),_(t,"area-selecting"),n.main.style.cursor="",v=u},s=function(e,t){e=e||window.event,t&&e.preventDefault&&e.preventDefault();var n=y.options,i=y.el,a=y.area,o=i.getBoundingClientRect(),s=i.offsetLeft,l=i.offsetTop,r=i.offsetWidth,c=i.offsetHeight,u=i.scrollLeft,h=i.scrollTop,_=0,d=0,m="e",f="s",d=n.withBorders?(i=B(i),_=X(i.borderLeftWidth),X(i.borderTopWidth)):_=0;g=t?(x=e.changedTouches[0].clientX-_-o.left,e.changedTouches[0].clientY-d-o.top):(x=e.clientX-_-o.left,e.clientY-d-o.top),x<0?x=0:r<=x&&(x=r-1),g<0?g=0:c<=g&&(g=c-1),Y&v?(d=a.w,o=a.h,x<p?(a.x=x,a.w=p-x,m="w"):(a.x=p,a.w=x-p),g<w?(a.y=g,a.h=w-g,f="n"):(a.y=w,a.h=g-w),n.ratioYX?a.h=R(a.w*n.ratioYX):n.ratioXY&&(a.w=R(a.h*n.ratioXY)),null!=n.minWidth&&a.w<n.minWidth&&(a.w=n.minWidth),null!=n.minHeight&&a.h<n.minHeight&&(a.h=n.minHeight),null!=n.maxWidth&&a.w>n.maxWidth&&(a.w=n.maxWidth),null!=n.maxHeight&&a.h>n.maxHeight&&(a.h=n.maxHeight),a.x+a.w>r&&(a.w=r-a.x-1),a.y+a.h>c&&(a.h=c-a.y-1),a.main.style.left=s-u+a.x+"px",a.main.style.top=l-h+a.y+"px",a.main.style.width=a.w+"px",a.main.style.height=a.h+"px",D(d-a.w)<2&&(m=""),D(o-a.h)<2&&(f=""),m||f||(m="se"),a.main.style.cursor=f+m+"-resize"):z&v?a.main===e.target&&(a.x+=x-p,a.y+=g-w,p=x,w=g,a.x+a.w>=r?a.x=r-a.w-1:a.x<0&&(a.x=0),a.y+a.h>=c?a.y=c-a.h-1:a.y<0&&(a.y=0),a.main.style.left=s-u+a.x+"px",a.main.style.top=l-h+a.y+"px",a.main.style.cursor="move"):N&v&&(H&v&&(x<a.x0?(a.x=x,a.w=a.x0-x):(a.x=a.x0,a.w=x-a.x0)),S&v&&(x>a.x1?(a.x=a.x1,a.w=x-a.x1):(a.x=x,a.w=a.x1-x)),T&v&&(g<a.y0?(a.y=g,a.h=a.y0-g):(a.y=a.y0,a.h=g-a.y0)),I&v&&(g>a.y1?(a.y=a.y1,a.h=g-a.y1):(a.y=g,a.h=a.y1-g)),n.ratioYX?L&v?a.h=R(a.w*n.ratioYX):a.w=R(a.h/n.ratioYX):n.ratioXY&&(C&v?a.w=R(a.h*n.ratioXY):a.h=R(a.w/n.ratioXY)),null!=n.minWidth&&a.w<n.minWidth&&(a.w=n.minWidth),null!=n.maxWidth&&a.w>n.maxWidth&&(a.w=n.maxWidth),null!=n.minHeight&&a.h<n.minHeight&&(a.h=n.minHeight),null!=n.maxHeight&&a.h>n.maxHeight&&(a.h=n.maxHeight),a.x+a.w>r&&(a.w=r-a.x-1),a.y+a.h>c&&(a.h=c-a.y-1),a.main.style.left=s-u+a.x+"px",a.main.style.top=l-h+a.y+"px",a.main.style.width=a.w+"px",a.main.style.height=a.h+"px",a.main.style.cursor=e.target.__DIR+"-resize")},l=function(e,t){var n=y.el,i=y.area,a=y.options;e=e||window.event,t&&e.preventDefault&&e.preventDefault(),y.selection={x1:R(i.x),y1:R(i.y),x2:R(i.x+i.w),y2:R(i.y+i.h)},p=w=x=g=0,t?(d(Z.body,"touchcancel",E),d(Z.body,"touchmove",b),d(Z.body,"touchend",W)):(d(Z.body,"mousemove",m),d(Z.body,"mouseup",f)),Y&v?_(i.main,"area-select-create"):z&v?_(i.main,"area-select-move"):N&v&&_(i.main,"area-select-resize"),_(i.main,"area-select-active"),_(n,"area-selecting"),i.main.style.cursor="",v=u,a.onSelect&&setTimeout(function(){a.onSelect.call(y,y.el,y.getSelection())},10)};t.__area_select_evt=[function(e){i(e,!1)},function(e){i(e,!0)}],k(t,"mousedown",t.__area_select_evt[0]),k(t,"touchstart",t.__area_select_evt[1]),k(n.__n,"mousedown",function(e){o(e,!1)}),k(n.__s,"mousedown",function(e){o(e,!1)}),k(n.__e,"mousedown",function(e){o(e,!1)}),k(n.__w,"mousedown",function(e){o(e,!1)}),k(n.__ne,"mousedown",function(e){o(e,!1)}),k(n.__nw,"mousedown",function(e){o(e,!1)}),k(n.__se,"mousedown",function(e){o(e,!1)}),k(n.__sw,"mousedown",function(e){o(e,!1)}),k(n.__n,"touchstart",function(e){o(e,!0)}),k(n.__s,"touchstart",function(e){o(e,!0)}),k(n.__e,"touchstart",function(e){o(e,!0)}),k(n.__w,"touchstart",function(e){o(e,!0)}),k(n.__ne,"touchstart",function(e){o(e,!0)}),k(n.__nw,"touchstart",function(e){o(e,!0)}),k(n.__se,"touchstart",function(e){o(e,!0)}),k(n.__sw,"touchstart",function(e){o(e,!0)}),k(n.main,"mousedown",function(e){a(e,!1)}),k(n.main,"touchstart",function(e){a(e,!0)})}return M.VERSION="1.1.0",M.prototype={constructor:M,el:null,area:null,selection:null,options:null,dispose:function(){var t=this,n=t.el,i=t.area;return t.deselect(),n&&(n.__area_select_evt&&(d(n,"mousedown",n.__area_select_evt[0]),d(n,"touchstart",n.__area_select_evt[1]),n.__area_select_evt=null),i&&i.main&&n.parentNode.removeChild(i.main),e.draggable=n.__area_select_draggable,n.__area_select_draggable=null,_(n,"area-selectable")),t.el=null,t.area=null,t.selection=null,t.options=null,t},element:function(e){return(e=this.el=e).__area_select_draggable=e.draggable||!1,e.draggable=!1,e.onmousedown=function(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!1},j(this.el,"area-selectable"),this},reset:function(){return this.selection=null,this.options={},this},show:function(){return this.area.main.style.display="block",this.area.main.style.cursor="",this},hide:function(){return this.area.main.style.display="none",this.area.main.style.cursor="",this},select:function(e){var t=this,n=t.el,i=t.area;return"object"==typeof e?(i.x=e.x1,i.y=e.y1,i.w=e.x2-e.x1,i.h=e.y2-e.y1,i.main.style.left=n.offsetLeft-n.scrollLeft+i.x+"px",i.main.style.top=n.offsetTop-n.scrollTop+i.y+"px",i.main.style.width=i.w+"px",i.main.style.height=i.h+"px",t.selection={x1:R(i.x),y1:R(i.y),x2:R(i.x+i.w),y2:R(i.y+i.h)}):!1===e&&(t.selection=null),t},deselect:function(){return this.selection=null,this.hide()},getSelection:function(){var e=this.selection;return e?{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,width:D(e.x2-e.x1),height:D(e.y2-e.y1)}:null}},M});